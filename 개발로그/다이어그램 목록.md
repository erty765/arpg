**## PopupActor íë¦„ë„**

---

config:

Â  theme: base

Â  layout: fixed

---

flowchart TD

Â    A\["ANAItemActor"] -- Before<br>Destroyed --> B\["Detach<br>ItemWidgetComponent"]

Â    B --> C\["Spawn<br>ANAItemWidgetPopupActor"]

Â    C --> D\["Attach \&amp; Register<br>Widget"]

Â    D --> E\["Play<br>Collapse Animation"]

Â    E --> F\["OnCollapseAnimationFinished<br>-\&gt; Destroy"]





**## DataTable ë¡œë”© ë° UNAItemData ë§¤í•‘ íë¦„ë„**

---

config:

Â  theme: base

Â  layout: fixed

---

flowchart LR

Â    A{"Engine<br>Initialization"} ==> B\["UNAItemEngineSubsystem::Initialize"]

Â    B --> C\["Load UItemDataTablesAsset"]

Â    C --> D\["Iterate ItemDataTables"]

Â    D --> E\["Load DataTable"]

Â    E --> F\["Map SoftItemMetaData with ItemClass as Key"]

Â    F --> G\["Iterate SoftItemMetaData and Synchronously Load ItemClass"]

Â    G --> H\["Build ItemMetaDataMap with ItemClass as Key"]

Â    H --> I\["Blueprint CDO Dynamic Initialization \& Compile"]

Â    I ==> J{"Item Metadata Initialization Complete"}

Â 



**## ì•„ì´í…œ ì‹œìŠ¤í…œ ì•¡í„° í´ë˜ìŠ¤ ìƒì† êµ¬ì¡°**

---

config:

Â  theme: base

Â  layout: elk

---

classDiagram

Â    class ANAItemActor {

Â        <<abstract>>

Â    }

Â    class ANAPickableItemActor

Â    class ANAMedPack

Â    class ANAUpgradeNode

Â    class ANAPlaceableItemActor {

Â        <<abstract>>

Â    }

Â    class ANADoor

Â    ANAItemActor <|-- ANAPickableItemActor

Â    ANAItemActor <|-- ANAPlaceableItemActor

Â    ANAPickableItemActor <|-- ANAMedPack

Â    ANAPickableItemActor <|-- ANAUpgradeNode

Â    ANAPlaceableItemActor <|-- ANADoor





**## ëŸ°íƒ€ì„ ì¤‘ ì•„ì´í…œ ì•¡í„° ìƒì„± íë¦„**

---

config:

Â  layout: elk

Â  theme: base

---

flowchart TD

Â    A\[ì•„ì´í…œ ìŠ¤í° ì‹œ] --> B\[ANAItemActor OnConstruction]

Â    B --> C\[InitItemData í˜¸ì¶œ]

Â    C --> D\[UNAItemEngineSubsystem CreateItemDataByActor]

Â    D --> E\[ItemMetaDataMap í†µí•´ ë©”íƒ€ë°ì´í„° ì—°ë™]

Â    E --> F\[ItemDataID í• ë‹¹]

Â    F --> G\[ì•¡í„° ì´ˆê¸°í™” ì™„ë£Œ]





**## ëŸ°íƒ€ì„ ì¤‘ ì•„ì´í…œ ì‚¬ìš© íë¦„**

---

config:

Â  layout: elk

Â  theme: base

---

flowchart TD

Â    A\["ì•„ì´í…œ ì‚¬ìš© ì‹œ"] --> B\["UNAItemData TryUseItem"]

Â    B --> C\["ItemClass Get GetDefaultObject"]

Â    C --> D\["CDOì—ì„œ INAItemUseInterface UseItem í˜¸ì¶œ"]





**## ì•„ì´í…œ ì•¡í„° íƒ€ì… êµ¬ì¡° -Pickable / Placeable**

---

config:

Â  theme: base

Â  layout: elk

---

classDiagram

direction TB

Â    class NAWeapon {

Â 	    +CombatComponent: UNAMontageCombatComponent

Â 	    +AbilitySystemComponent: UAbilitySystemComponent

Â 	    +MuzzleFlashComponent: UNiagaraComponent

Â 	    +AmmoIndicatorComponent: UNAAmmoIndicatorComponent

Â 	    +FireArmType: EFireArmType

Â 	    +GetFireArmType()

Â    }

Â    class NAMedpack {

Â 	    +MedPackGrade: EMedPackGrade

Â 	    +CanUseItem()

Â 	    +UseItem()

Â    }

Â    class NADoor {

Â 	    +Door1: UStaticMeshComponent

Â 	    +Door2: UStaticMeshComponent

Â 	    +DoorType: EDoorType

Â 	    +MoveDist: double

Â 	    +ToggleDoor()

Â    }

Â    class ANAPlaceableItemActor {

Â 	    +InteractableType

Â 	    +Implements ExecuteInteract()

Â    }

Â 	class ANAPickableItemActor {

Â 	    +PickupMode: EPickupMode

Â 	    +TryPerformAutoUse()

Â    }

Â    class ANAItemActor {

Â 	    +ItemCollision: UShapeComponent

Â 	    +ItemMesh: UMeshComponent

Â 	    +TriggerSphere: USphereComponent

Â 	    +ItemWidgetComponent: UNAItemWidgetComponent

Â 	    +GetItemData()

Â 	    +CanInteract()

Â 	    +TryInteract()

Â 	    +NotifyFocusBegin/End()

Â    }



Â    ANAItemActor <|-- ANAPickableItemActor

Â    ANAItemActor <|-- ANAPlaceableItemActor

Â    ANAPickableItemActor <|-- NAWeapon

Â    ANAPickableItemActor <|-- NAMedpack

Â    ANAPlaceableItemActor <|-- NADoor



Â    <<Abstract>> ANAPickableItemActor

Â    <<Abstract>> ANAPlaceableItemActor

Â    <<Abstract>> ANAItemActor



Â    note for ANAItemActor "ì›”ë“œ ì•„ì´í…œ ê¸°ë³¸,<br>ì‹œê°/ì¶©ëŒ/ìƒí˜¸ì‘ìš© ì œê³µ"

Â    note for ANAPickableItemActor "íšë“ ê°€ëŠ¥ ì•„ì´í…œ<br>(ì¸ë²¤í† ë¦¬/ìë™ì‚¬ìš©/ë“¤ê¸°) ë‹´ë‹¹"

Â    note for ANAPlaceableItemActor "ë°°ì¹˜ ê°€ëŠ¥ ì•„ì´í…œ<br>(í™˜ê²½ ìƒí˜¸ì‘ìš©) ë‹´ë‹¹"





**## ì•„ì´í…œ ì•¡í„°ì™€ ì•„ì´í…œ ë°ì´í„°ì˜ ê´€ê³„**

---

config:

Â  layout: elk

Â  theme: base

---

flowchart LR

Â    A\["ANAItemActor<br>Visual Representation + Interaction"] -- Refers by ItemDataID(FName) --> B\["UNAItemData<br>Quantity, State, Metadata Reference + Use Logic"]

Â    B -. Accesses Item Actor CDO<br>via metadata .-> A





**## CreateItemDataByActor**

---

config:

Â  theme: base

---

flowchart TD

Â    A\[Actor Spawned] --> B\[Check ItemDataID]

Â    B --> C\[Lookup Metadata]

Â    C --> D\[Create UNAItemData]

Â    D --> E\[Configure Subobjects Dynamically]





**## ë°ì´í„° ì¤‘ì‹¬ì˜ ì´ˆê¸°í™” íë¦„**

---

config:

Â  theme: base

Â  look: neo

Â  layout: elk

---

flowchart LR

Â    Start\["Engine Init"] --> Load\["Load<br>DataTables Asset"]

Â    Load --> Map\["Map:<br>ItemClass â†’ RowHandle"]

Â    Map --> Init\["Initialize Item CDO"]





**## í´ë˜ìŠ¤ â†” ë°ì´í„° í–‰ ìë™ ë§¤í•‘ êµ¬ì¡°**

---

config:

Â  theme: base

Â  layout: fixed

---

flowchart TD

Â    A\["DataTable (FNAItemBaseTableRow)"] --> B\["Item RowHandle (RowName)"]

Â    B --> C\["SoftClassPtr(ANAItemActor)"]

Â    C --> D\["ANAItemActor CDO"]

Â    D --> E\["Dynamic Init by Metadata"]





**## Interaction Flow with Custom Point**

---

config:

Â  theme: base

Â  layout: fixed

---

flowchart TD

Â    A\["Player overlaps item trigger"] --> B\["NotifyInteractableFocusBegin()"]

Â    B --> C\["Register in FocusedInteractables<br>+ Enable Tick"]

Â    C --> D\["Player presses interaction key"]

Â    D --> F\["Call StratInteraction()"]

Â    F --> G\["PickupMode<br>ğŸ”§Designer-controlled"] \& J\["InteractableType<br>ğŸ”§Designer-controlled"]

Â    G -- AutoUse --> H1\["TryPerformAutoUse()"]

Â    G -- Inventory --> H2\["TryAddItemToInventory()"]

Â    G -- CarryOnly --> H3\["TryAttachItemMeshToOwner()"]

Â    H1 --> I1{"Item fully consumed?"}

Â    I1 -- Yes --> Z1\["Destroy Item Actor"]

Â    I1 -- No --> Z2\["Update Item Quantity"]

Â    H2 --> I2{"Inventory full?"}

Â    I2 -- Yes --> Z3\["Interaction failed"]

Â    I2 -- No --> Z4\["Add to inventory<br>â†’ Destroy or keep"]

Â    H3 --> I3{"Hand empty?"}

Â    I3 -- Yes --> Z5\["Attach item to hand<br>- ChildActor"]

Â    I3 -- No --> Z6\["Use item<br>or Drop item"]

Â    J -- Inspect --> K1\["Show inspect UI"]

Â    J -- Install --> K2\["Start placement mode"]

Â    J -- Toggle --> K3\["Toggle actor state"]

Â    Z1 --> END(\["Finalize interaction"])

Â    Z2 --> END

Â    Z3 --> END

Â    Z4 --> END

Â    Z5 --> END

Â    Z6 --> END

Â    K1 --> END

Â    K2 --> END

Â    K3 --> END

Â    G@{ shape: rounded}

Â    J@{ shape: rounded}

Â     G:::Aqua

Â     J:::Aqua

Â    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A





**## ì•„ì´í…œ ì•¡í„° ìƒì„± ìš”ì²­ì˜ ì‹œì‘ì **

---

config:

Â  layout: fixed

Â  theme: base

---

flowchart TD

Â subgraph subGraph0\["Main Request Origin Points"]

Â        A\["Player Item Acquisition"]

Â        C\["Monster Item Drop"]

Â        E\["Shop Item Purchase"]

Â  end

Â subgraph subGraph1\["Intermediate Request Processing"]

Â        B("Inventory Component")

Â        D("Monster Drop Logic")

Â        F("Shop System")

Â  end

Â subgraph subGraph2\["Central Management System"]

Â        G("UNAItemEngineSubsystem")

Â  end

Â    A --> B

Â    C --> D

Â    E --> F

Â    B --> G

Â    D --> G

Â    F --> G

Â    G --> H\["Item Actor Creation and Initialization"]

Â     G:::Aqua

Â    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A





**## ì•„ì´í…œ ìŠ¤í° ë° ë°ì´í„° ì£¼ì… íë¦„**

---

config:

&nbsp; layout: elk

&nbsp; theme: base

---

flowchart LR

&nbsp;subgraph ANAItemActor\["ANAItemActor Instance"]

&nbsp;       D{"Is it a valid new instance?"}

&nbsp;       C\["ANAItemActor Creation<br>(Editor Placement<br>/Runtime Spawn)"]

&nbsp;       E\["ANAItemActor::InitItemData()"]

&nbsp; end

&nbsp;subgraph UNAItemData\["UNAItemData Creation and Injection"]

&nbsp;       F\["UNAItemEngineSubsystem::CreateItemDataByActor()<br>(Through ANAItemActor instance)"]

&nbsp;       G("Search FDataTableRowHandle based on<br>Item Actor Class")

&nbsp;       H("Create new UNAItemData instance<br>and assign unique Item ID")

&nbsp;       I("Store UNAItemData in RuntimeItemDataMap")

&nbsp;       J("Return generated UNAItemData ID")

&nbsp; end

&nbsp;   C --> D

&nbsp;   D -- Yes --> E

&nbsp;   E --> F

&nbsp;   F --> G

&nbsp;   G --> H

&nbsp;   H --> I

&nbsp;   I --> J

&nbsp;   J --> K("Store UNAItemData ID in<br>ANAItemActor::ItemDataID")

&nbsp;   K --> L\["Fully Initialized<br>ANAItemActor"]

&nbsp;   D -- No --> L





**## ì•„ì´í…œ ì•¡í„° ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™” íë¦„**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["UNAItemEngineSubsystem::Initialize"]

&nbsp;       A\["Load Item DataTables"]

&nbsp;       B\["Build ItemMetaDataMap"]

&nbsp;       C\["Iterate SoftItemMetaData<br>(Class Lookup)"]

&nbsp;       D\["FKismetEditorUtilities::CompileBlueprint<br>(Editor-only Sync)"]

&nbsp; end

&nbsp;subgraph s2\["ANAItemActor Lifecycle"]

&nbsp;       E\["E"]

&nbsp;       F\["F"]

&nbsp;       G\["BeginPlay():<br>Replace Root with ItemCollision"]

&nbsp;       H\["Configure Physics \& Replication"]

&nbsp; end

&nbsp;subgraph E\["Constructor()"]

&nbsp;       E1\["Create All Core Subobjects"]

&nbsp;       E2\["Create All Core Subobjects"]

&nbsp; end

&nbsp;subgraph F\["OnConstruction()"]

&nbsp;       F1\["Verify \&amp; Sync<br>Subobject Properties"]

&nbsp;       F2\["Adjust Component Instances<br>\&amp; Hierarchy"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B --> C

&nbsp;   C -- LoadSynchronous<br>(ItemClass) --> D

&nbsp;   D -.-> E1

&nbsp;   E1 --- E2

&nbsp;   E2 --> F1

&nbsp;   F1 --- F2

&nbsp;   F2 --> G

&nbsp;   G --> H

&nbsp;    E1:::Aqua

&nbsp;    E2:::Aqua

&nbsp;    F1:::Peach

&nbsp;    F2:::Peach

&nbsp;   classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A

&nbsp;   classDef Peach stroke-width:1px, stroke-dasharray:none, stroke:#FBB35A, fill:#FFEFDB, color:#8F632D





**## ANAItemActorì˜ Constructor ë¡œì§ íë¦„**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor Constructor Flow"]

&nbsp;       A\["Constructor Start"]

&nbsp;       B{"Check<br>ItemMetaData Validity"}

&nbsp;       C\["Create Core Item Components (Collision, Mesh, Trigger, Widget)"]

&nbsp;       D\["Set RootComponent to USceneComponent"]

&nbsp;       E\["Attach All Components to RootComponent"]

&nbsp;       F\["Initialize ItemDataID to NAME\_None"]

&nbsp;       G\["Set Actor and Movement Replication"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Valid Metadata --> C

&nbsp;   C --> D

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F --> G





**##  ANAItemActorì˜ OnConstruction ë¡œì§ íë¦„**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor OnConstruction Logic Flow"]

&nbsp;       A\["OnConstruction Start"]

&nbsp;       B{"Check EngineSubsystem Init<br>\&amp; Class Registration"}

&nbsp;       C{"Is Actor not CDO/ChildActor<br>\&amp; ItemDataID is None?"}

&nbsp;       D\["InitItemData()"]

&nbsp;       E\["Retrieve Item Metadata (FNAItemBaseTableRow)"]

&nbsp;       F{"Calculate Dirty Flags (Collision/Mesh Type Changed?)"}

&nbsp;       G\_UpdateComponents\["Update Dynamic Item Components (Recreate/Replace/Clean)"]

&nbsp;       H\_SetProperties\["Set Component Properties from Metadata"]

&nbsp;       M\["Register All Components"]

&nbsp;       I\_FinalizeTransform\["Finalize Component Transforms \& Network"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Yes --> C

&nbsp;   B -- No --> E

&nbsp;   C -- Yes --> D

&nbsp;   C -- No --> E

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F -- Dirty --> G\_UpdateComponents

&nbsp;   F -- Not Dirty --> M

&nbsp;   G\_UpdateComponents --> H\_SetProperties

&nbsp;   H\_SetProperties --> M

&nbsp;   M --> I\_FinalizeTransform





**## ANAItemActorì˜ BeginPlay ë¡œì§ íë¦„**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor BeginPlay Logic Flow"]

&nbsp;       A\["BeginPlay Start"]

&nbsp;       B{"Is bNeedItemCollision True?"}

&nbsp;       C\["ReplaceRootWithItemCollisionIfNeeded()"]

&nbsp;       D\["Super::BeginPlay()"]

&nbsp;       E\["InitCheckIfChildActor()"]

&nbsp;       F{"Are InteractableInterfaceRef<br>\&amp; TriggerSphere Valid?"}

&nbsp;       G\["Bind Overlap Delegates<br>\&amp; Schedule Initial Overlaps"]

&nbsp;       H{"HasValidItemID()"}

&nbsp;       I\["Initialize ItemData Quantity"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Yes --> C

&nbsp;   C --> D

&nbsp;   B -- No --> D

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F -- Yes --> G

&nbsp;   G --> H

&nbsp;   F -- No --> H

&nbsp;   H -- Yes --> I



