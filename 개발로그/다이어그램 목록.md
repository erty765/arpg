**## PopupActor 흐름도**

---

config:

  theme: base

  layout: fixed

---

flowchart TD

    A\["ANAItemActor"] -- Before<br>Destroyed --> B\["Detach<br>ItemWidgetComponent"]

    B --> C\["Spawn<br>ANAItemWidgetPopupActor"]

    C --> D\["Attach \&amp; Register<br>Widget"]

    D --> E\["Play<br>Collapse Animation"]

    E --> F\["OnCollapseAnimationFinished<br>-\&gt; Destroy"]





**## DataTable 로딩 및 UNAItemData 매핑 흐름도**

---

config:

  theme: base

  layout: fixed

---

flowchart LR

    A{"Engine<br>Initialization"} ==> B\["UNAItemEngineSubsystem::Initialize"]

    B --> C\["Load UItemDataTablesAsset"]

    C --> D\["Iterate ItemDataTables"]

    D --> E\["Load DataTable"]

    E --> F\["Map SoftItemMetaData with ItemClass as Key"]

    F --> G\["Iterate SoftItemMetaData and Synchronously Load ItemClass"]

    G --> H\["Build ItemMetaDataMap with ItemClass as Key"]

    H --> I\["Blueprint CDO Dynamic Initialization \& Compile"]

    I ==> J{"Item Metadata Initialization Complete"}

 



**## 아이템 시스템 액터 클래스 상속 구조**

---

config:

  theme: base

  layout: elk

---

classDiagram

    class ANAItemActor {

        <<abstract>>

    }

    class ANAPickableItemActor

    class ANAMedPack

    class ANAUpgradeNode

    class ANAPlaceableItemActor {

        <<abstract>>

    }

    class ANADoor

    ANAItemActor <|-- ANAPickableItemActor

    ANAItemActor <|-- ANAPlaceableItemActor

    ANAPickableItemActor <|-- ANAMedPack

    ANAPickableItemActor <|-- ANAUpgradeNode

    ANAPlaceableItemActor <|-- ANADoor





**## 런타임 중 아이템 액터 생성 흐름**

---

config:

  layout: elk

  theme: base

---

flowchart TD

    A\[아이템 스폰 시] --> B\[ANAItemActor OnConstruction]

    B --> C\[InitItemData 호출]

    C --> D\[UNAItemEngineSubsystem CreateItemDataByActor]

    D --> E\[ItemMetaDataMap 통해 메타데이터 연동]

    E --> F\[ItemDataID 할당]

    F --> G\[액터 초기화 완료]





**## 런타임 중 아이템 사용 흐름**

---

config:

  layout: elk

  theme: base

---

flowchart TD

    A\["아이템 사용 시"] --> B\["UNAItemData TryUseItem"]

    B --> C\["ItemClass Get GetDefaultObject"]

    C --> D\["CDO에서 INAItemUseInterface UseItem 호출"]





**## 아이템 액터 타입 구조 -Pickable / Placeable**

---

config:

  theme: base

  layout: elk

---

classDiagram

direction TB

    class NAWeapon {

 	    +CombatComponent: UNAMontageCombatComponent

 	    +AbilitySystemComponent: UAbilitySystemComponent

 	    +MuzzleFlashComponent: UNiagaraComponent

 	    +AmmoIndicatorComponent: UNAAmmoIndicatorComponent

 	    +FireArmType: EFireArmType

 	    +GetFireArmType()

    }

    class NAMedpack {

 	    +MedPackGrade: EMedPackGrade

 	    +CanUseItem()

 	    +UseItem()

    }

    class NADoor {

 	    +Door1: UStaticMeshComponent

 	    +Door2: UStaticMeshComponent

 	    +DoorType: EDoorType

 	    +MoveDist: double

 	    +ToggleDoor()

    }

    class ANAPlaceableItemActor {

 	    +InteractableType

 	    +Implements ExecuteInteract()

    }

 	class ANAPickableItemActor {

 	    +PickupMode: EPickupMode

 	    +TryPerformAutoUse()

    }

    class ANAItemActor {

 	    +ItemCollision: UShapeComponent

 	    +ItemMesh: UMeshComponent

 	    +TriggerSphere: USphereComponent

 	    +ItemWidgetComponent: UNAItemWidgetComponent

 	    +GetItemData()

 	    +CanInteract()

 	    +TryInteract()

 	    +NotifyFocusBegin/End()

    }



    ANAItemActor <|-- ANAPickableItemActor

    ANAItemActor <|-- ANAPlaceableItemActor

    ANAPickableItemActor <|-- NAWeapon

    ANAPickableItemActor <|-- NAMedpack

    ANAPlaceableItemActor <|-- NADoor



    <<Abstract>> ANAPickableItemActor

    <<Abstract>> ANAPlaceableItemActor

    <<Abstract>> ANAItemActor



    note for ANAItemActor "월드 아이템 기본,<br>시각/충돌/상호작용 제공"

    note for ANAPickableItemActor "획득 가능 아이템<br>(인벤토리/자동사용/들기) 담당"

    note for ANAPlaceableItemActor "배치 가능 아이템<br>(환경 상호작용) 담당"





**## 아이템 액터와 아이템 데이터의 관계**

---

config:

  layout: elk

  theme: base

---

flowchart LR

    A\["ANAItemActor<br>Visual Representation + Interaction"] -- Refers by ItemDataID(FName) --> B\["UNAItemData<br>Quantity, State, Metadata Reference + Use Logic"]

    B -. Accesses Item Actor CDO<br>via metadata .-> A





**## CreateItemDataByActor**

---

config:

  theme: base

---

flowchart TD

    A\[Actor Spawned] --> B\[Check ItemDataID]

    B --> C\[Lookup Metadata]

    C --> D\[Create UNAItemData]

    D --> E\[Configure Subobjects Dynamically]





**## 데이터 중심의 초기화 흐름**

---

config:

  theme: base

  look: neo

  layout: elk

---

flowchart LR

    Start\["Engine Init"] --> Load\["Load<br>DataTables Asset"]

    Load --> Map\["Map:<br>ItemClass → RowHandle"]

    Map --> Init\["Initialize Item CDO"]





**## 클래스 ↔ 데이터 행 자동 매핑 구조**

---

config:

  theme: base

  layout: fixed

---

flowchart TD

    A\["DataTable (FNAItemBaseTableRow)"] --> B\["Item RowHandle (RowName)"]

    B --> C\["SoftClassPtr(ANAItemActor)"]

    C --> D\["ANAItemActor CDO"]

    D --> E\["Dynamic Init by Metadata"]





**## Interaction Flow with Custom Point**

---

config:

  theme: base

  layout: fixed

---

flowchart TD

    A\["Player overlaps item trigger"] --> B\["NotifyInteractableFocusBegin()"]

    B --> C\["Register in FocusedInteractables<br>+ Enable Tick"]

    C --> D\["Player presses interaction key"]

    D --> F\["Call StratInteraction()"]

    F --> G\["PickupMode<br>🔧Designer-controlled"] \& J\["InteractableType<br>🔧Designer-controlled"]

    G -- AutoUse --> H1\["TryPerformAutoUse()"]

    G -- Inventory --> H2\["TryAddItemToInventory()"]

    G -- CarryOnly --> H3\["TryAttachItemMeshToOwner()"]

    H1 --> I1{"Item fully consumed?"}

    I1 -- Yes --> Z1\["Destroy Item Actor"]

    I1 -- No --> Z2\["Update Item Quantity"]

    H2 --> I2{"Inventory full?"}

    I2 -- Yes --> Z3\["Interaction failed"]

    I2 -- No --> Z4\["Add to inventory<br>→ Destroy or keep"]

    H3 --> I3{"Hand empty?"}

    I3 -- Yes --> Z5\["Attach item to hand<br>- ChildActor"]

    I3 -- No --> Z6\["Use item<br>or Drop item"]

    J -- Inspect --> K1\["Show inspect UI"]

    J -- Install --> K2\["Start placement mode"]

    J -- Toggle --> K3\["Toggle actor state"]

    Z1 --> END(\["Finalize interaction"])

    Z2 --> END

    Z3 --> END

    Z4 --> END

    Z5 --> END

    Z6 --> END

    K1 --> END

    K2 --> END

    K3 --> END

    G@{ shape: rounded}

    J@{ shape: rounded}

     G:::Aqua

     J:::Aqua

    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A





**## 아이템 액터 생성 요청의 시작점**

---

config:

  layout: fixed

  theme: base

---

flowchart TD

 subgraph subGraph0\["Main Request Origin Points"]

        A\["Player Item Acquisition"]

        C\["Monster Item Drop"]

        E\["Shop Item Purchase"]

  end

 subgraph subGraph1\["Intermediate Request Processing"]

        B("Inventory Component")

        D("Monster Drop Logic")

        F("Shop System")

  end

 subgraph subGraph2\["Central Management System"]

        G("UNAItemEngineSubsystem")

  end

    A --> B

    C --> D

    E --> F

    B --> G

    D --> G

    F --> G

    G --> H\["Item Actor Creation and Initialization"]

     G:::Aqua

    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A





**## 아이템 스폰 및 데이터 주입 흐름**

---

config:

&nbsp; layout: elk

&nbsp; theme: base

---

flowchart LR

&nbsp;subgraph ANAItemActor\["ANAItemActor Instance"]

&nbsp;       D{"Is it a valid new instance?"}

&nbsp;       C\["ANAItemActor Creation<br>(Editor Placement<br>/Runtime Spawn)"]

&nbsp;       E\["ANAItemActor::InitItemData()"]

&nbsp; end

&nbsp;subgraph UNAItemData\["UNAItemData Creation and Injection"]

&nbsp;       F\["UNAItemEngineSubsystem::CreateItemDataByActor()<br>(Through ANAItemActor instance)"]

&nbsp;       G("Search FDataTableRowHandle based on<br>Item Actor Class")

&nbsp;       H("Create new UNAItemData instance<br>and assign unique Item ID")

&nbsp;       I("Store UNAItemData in RuntimeItemDataMap")

&nbsp;       J("Return generated UNAItemData ID")

&nbsp; end

&nbsp;   C --> D

&nbsp;   D -- Yes --> E

&nbsp;   E --> F

&nbsp;   F --> G

&nbsp;   G --> H

&nbsp;   H --> I

&nbsp;   I --> J

&nbsp;   J --> K("Store UNAItemData ID in<br>ANAItemActor::ItemDataID")

&nbsp;   K --> L\["Fully Initialized<br>ANAItemActor"]

&nbsp;   D -- No --> L





**## 아이템 액터 컴포넌트 초기화 흐름**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["UNAItemEngineSubsystem::Initialize"]

&nbsp;       A\["Load Item DataTables"]

&nbsp;       B\["Build ItemMetaDataMap"]

&nbsp;       C\["Iterate SoftItemMetaData<br>(Class Lookup)"]

&nbsp;       D\["FKismetEditorUtilities::CompileBlueprint<br>(Editor-only Sync)"]

&nbsp; end

&nbsp;subgraph s2\["ANAItemActor Lifecycle"]

&nbsp;       E\["E"]

&nbsp;       F\["F"]

&nbsp;       G\["BeginPlay():<br>Replace Root with ItemCollision"]

&nbsp;       H\["Configure Physics \& Replication"]

&nbsp; end

&nbsp;subgraph E\["Constructor()"]

&nbsp;       E1\["Create All Core Subobjects"]

&nbsp;       E2\["Create All Core Subobjects"]

&nbsp; end

&nbsp;subgraph F\["OnConstruction()"]

&nbsp;       F1\["Verify \&amp; Sync<br>Subobject Properties"]

&nbsp;       F2\["Adjust Component Instances<br>\&amp; Hierarchy"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B --> C

&nbsp;   C -- LoadSynchronous<br>(ItemClass) --> D

&nbsp;   D -.-> E1

&nbsp;   E1 --- E2

&nbsp;   E2 --> F1

&nbsp;   F1 --- F2

&nbsp;   F2 --> G

&nbsp;   G --> H

&nbsp;    E1:::Aqua

&nbsp;    E2:::Aqua

&nbsp;    F1:::Peach

&nbsp;    F2:::Peach

&nbsp;   classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A

&nbsp;   classDef Peach stroke-width:1px, stroke-dasharray:none, stroke:#FBB35A, fill:#FFEFDB, color:#8F632D





**## ANAItemActor의 Constructor 로직 흐름**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor Constructor Flow"]

&nbsp;       A\["Constructor Start"]

&nbsp;       B{"Check<br>ItemMetaData Validity"}

&nbsp;       C\["Create Core Item Components (Collision, Mesh, Trigger, Widget)"]

&nbsp;       D\["Set RootComponent to USceneComponent"]

&nbsp;       E\["Attach All Components to RootComponent"]

&nbsp;       F\["Initialize ItemDataID to NAME\_None"]

&nbsp;       G\["Set Actor and Movement Replication"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Valid Metadata --> C

&nbsp;   C --> D

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F --> G





**##  ANAItemActor의 OnConstruction 로직 흐름**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor OnConstruction Logic Flow"]

&nbsp;       A\["OnConstruction Start"]

&nbsp;       B{"Check EngineSubsystem Init<br>\&amp; Class Registration"}

&nbsp;       C{"Is Actor not CDO/ChildActor<br>\&amp; ItemDataID is None?"}

&nbsp;       D\["InitItemData()"]

&nbsp;       E\["Retrieve Item Metadata (FNAItemBaseTableRow)"]

&nbsp;       F{"Calculate Dirty Flags (Collision/Mesh Type Changed?)"}

&nbsp;       G\_UpdateComponents\["Update Dynamic Item Components (Recreate/Replace/Clean)"]

&nbsp;       H\_SetProperties\["Set Component Properties from Metadata"]

&nbsp;       M\["Register All Components"]

&nbsp;       I\_FinalizeTransform\["Finalize Component Transforms \& Network"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Yes --> C

&nbsp;   B -- No --> E

&nbsp;   C -- Yes --> D

&nbsp;   C -- No --> E

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F -- Dirty --> G\_UpdateComponents

&nbsp;   F -- Not Dirty --> M

&nbsp;   G\_UpdateComponents --> H\_SetProperties

&nbsp;   H\_SetProperties --> M

&nbsp;   M --> I\_FinalizeTransform





**## ANAItemActor의 BeginPlay 로직 흐름**

---

config:

&nbsp; theme: base

&nbsp; layout: elk

---

flowchart LR

&nbsp;subgraph s1\["ANAItemActor BeginPlay Logic Flow"]

&nbsp;       A\["BeginPlay Start"]

&nbsp;       B{"Is bNeedItemCollision True?"}

&nbsp;       C\["ReplaceRootWithItemCollisionIfNeeded()"]

&nbsp;       D\["Super::BeginPlay()"]

&nbsp;       E\["InitCheckIfChildActor()"]

&nbsp;       F{"Are InteractableInterfaceRef<br>\&amp; TriggerSphere Valid?"}

&nbsp;       G\["Bind Overlap Delegates<br>\&amp; Schedule Initial Overlaps"]

&nbsp;       H{"HasValidItemID()"}

&nbsp;       I\["Initialize ItemData Quantity"]

&nbsp; end

&nbsp;   A --> B

&nbsp;   B -- Yes --> C

&nbsp;   C --> D

&nbsp;   B -- No --> D

&nbsp;   D --> E

&nbsp;   E --> F

&nbsp;   F -- Yes --> G

&nbsp;   G --> H

&nbsp;   F -- No --> H

&nbsp;   H -- Yes --> I



